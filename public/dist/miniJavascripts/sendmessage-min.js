let token=localStorage.getItem("token");document.getElementById("input").addEventListener("keypress",function(e){if(13===(e.which||e.keyCode)){let t=document.getElementById("input").value,s=localStorage.getItem("email");fetch("https://thebestchatappever.herokuapp.com/messages/save",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:token,message:t,token:token,messageto:s})}).then(t=>{let s=localStorage.getItem("token");return fetch(`https://thebestchatappever.herokuapp.com/messages/get/${s}`).then(function(e){return e.json()}).then(function(t){let s=t.data,n=document.getElementById("input").value;if(""!=n)for(let t=0;t<s.length;t++)if(s[t].message==n){let a=s[t]._id;primus.write({action:"clicked",input:n,messageid:a,username:s[t].messageto}),document.getElementById("input").value="",e.preventDefault()}}),t.json()})}});const userNameArray=[];window.onload=function(){fetch("https://thebestchatappever.herokuapp.com/messages/getusers").then(function(e){return e.json()}).then(function(e){let t=e.emailadres;for(let s=0;s<e.data.length;s++){let n=e.data[s]._id,a=e.data[s].username;if(t===e.data[s]._id){let e=localStorage.getItem("email");document.getElementById("loggedin").innerHTML=e}userNameArray.push({userid:n,username:a})}});let e=localStorage.getItem("token");fetch(`https://thebestchatappever.herokuapp.com/messages/get/${e}`).then(function(e){return e.json()}).then(function(e){let t=e.data;localStorage.setItem("userid",e.id);for(let s=0;s<t.length;s++){let n="";for(let a=0;a<userNameArray.length;a++)if(userNameArray[a].userid==t[s].username){let d=userNameArray[a].username;n+="<div class='messagewrapper'>",n+="<p id='pid"+t[s]._id+"'>"+d+" : <span id='spanmessage"+t[s]._id+"'>"+t[s].message+"</span>",e.id==t[s].username&&(n+="<button id ='"+t[s]._id+"' onclick='deletethismessage(this)' class='btn btn--delete'>DEL</button>",n+="<button id ='"+t[s]._id+"' onclick='showUpdate(this)' class='btn btn--showupdate show"+t[s]._id+"'>UPD</button>"),n+="</div>",n+="<br>",n+="<input class='input hide' type='text' id='updateinput"+t[s]._id+"' value='"+t[s].message+"'>",n+="<button class='btn btn--update hide "+t[s]._id+"' id ='"+t[s]._id+"' onclick='updatethismessage(this);hidebtns(this)'>UPD</button>",n+="</p>",document.getElementById("displaymessages").innerHTML+=n,$(".displaymessages").stop().animate({scrollTop:$(".displaymessages")[0].scrollHeight},1e3)}}}),document.getElementById("loggedin").innerHTML=localStorage.getItem("email")};let showUpdate=e=>{let t=e.id;document.getElementById("updateinput"+t).classList.remove("hide"),document.getElementById("updateinput"+t).classList.add("show");let s=document.getElementsByClassName(""+t)[0];s.classList.remove("hide"),s.classList.add("show"),e.classList.add("hide")},hidebtns=e=>{let t=e.id;document.getElementById("updateinput"+t).classList.remove("show"),document.getElementById("updateinput"+t).classList.add("hide");let s=document.getElementsByClassName(""+t)[0];s.classList.remove("show"),s.classList.add("hide"),document.getElementsByClassName(`show${t}`)[0].classList.remove("hide"),document.getElementsByClassName(`show${t}`)[0].classList.add("show")},findById=()=>{let e=document.getElementById("inputgetbyid").value;fetch(`https://thebestchatappever.herokuapp.com/messages/getbyid/${e}`).then(function(e){return e.json()}).then(function(e){return e.data.docs[0].message}).then(function(e){document.getElementById("showbyid").innerHTML="Message: "+e}),document.getElementById("inputgetbyid").value=""};